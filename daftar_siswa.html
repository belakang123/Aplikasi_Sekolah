<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Daftar Siswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f5f7fa;
      }
    </style>
</head>
<body class="min-h-screen bg-gray-100">
    <header class="bg-blue-900 text-white py-4">
        <div class="container mx-auto px-4 flex items-center">
            <button
              onclick="window.history.back()"
              class="mr-4 text-white hover:text-gray-300"
              aria-label="Kembali"
            >
              <i class="fas fa-arrow-left"></i>
            </button>
            <h1 class="text-2xl font-bold">Daftar Siswa</h1>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- Search -->
        <form id="searchForm" class="mb-6 flex flex-col sm:flex-row sm:items-center sm:space-x-3">
            <input
              type="text"
              id="searchInput"
              placeholder="Cari siswa..."
              class="flex-grow p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3 sm:mb-0 transition"
              aria-label="Cari siswa"
            />
            <button
              type="submit"
              class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg shadow-md hover:from-blue-700 hover:to-blue-800 transition"
            >
              CARI
            </button>
        </form>

        <!-- Student Table -->
        <div class="overflow-x-auto bg-white rounded-lg shadow">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase">Nama</th>
                        <th class="px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase">NISN</th>
                        <th class="px-4 py-2 text-left text-xs font-semibold text-gray-700 uppercase">Kelas</th>
                        <th class="px-4 py-2 text-center text-xs font-semibold text-gray-700 uppercase">Aksi</th>
                    </tr>
                </thead>
                <tbody id="studentTableBody" class="divide-y divide-gray-200">
                    <!-- Rows will be rendered here -->
                </tbody>
            </table>
        </div>

        <!-- Input Form -->
        <section class="mt-6 bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-semibold mb-4">Input Siswa</h2>
            <form id="studentForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="studentName" class="block mb-1 font-semibold">Nama Lengkap</label>
                    <input
                      type="text"
                      id="studentName"
                      class="w-full p-2 border border-gray-300 rounded"
                      required
                      aria-required="true"
                    />
                </div>
                <div>
                    <label for="studentClass" class="block mb-1 font-semibold">Kelas</label>
                    <input
                      type="text"
                      id="studentClass"
                      class="w-full p-2 border border-gray-300 rounded"
                      required
                      aria-required="true"
                    />
                </div>
                <div>
                    <label for="studentNISN" class="block mb-1 font-semibold">NISN</label>
                    <input
                      type="text"
                      id="studentNISN"
                      class="w-full p-2 border border-gray-300 rounded"
                      required
                      aria-required="true"
                    />
                </div>
                <div>
                    <label for="studentAddress" class="block mb-1 font-semibold">Alamat</label>
                    <input
                      type="text"
                      id="studentAddress"
                      class="w-full p-2 border border-gray-300 rounded"
                      required
                      aria-required="true"
                    />
                </div>
                <div class="sm:col-span-2">
                    <button
                      type="submit"
                      class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
                      id="submitButton"
                    >
                      Tambah
                    </button>
                    <button
                      type="button"
                      class="ml-2 px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 hidden"
                      id="cancelEditButton"
                    >
                      Batal
                    </button>
                </div>
            </form>
        </section>
    </main>

    <!-- Modal for Student Detail -->
    <div id="studentDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
      <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative">
        <button id="closeModalBtn" class="absolute top-2 right-2 text-gray-600 hover:text-gray-900 text-xl font-bold">&times;</button>
        <h3 class="text-xl font-semibold mb-4">Detail Siswa</h3>
      <div id="studentDetailContent" class="space-y-3 text-gray-800 text-base leading-relaxed">
          <!-- Student details will be injected here -->
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script>
        let students = JSON.parse(localStorage.getItem('studentsApp') || '[]');
        let editStudentId = null;

        function saveStudents() {
            localStorage.setItem('studentsApp', JSON.stringify(students));
        }

        function renderStudentList(filter = '') {
            const tbody = document.getElementById('studentTableBody');
            tbody.innerHTML = '';

            const filteredStudents = students.filter(student => {
                const searchText = filter.toLowerCase().trim();
                if (!searchText) return true;
                return (
                    student.name.toLowerCase().includes(searchText) ||
                    student.nisn.toLowerCase().includes(searchText) ||
                    student.class.toLowerCase().includes(searchText) ||
                    student.address.toLowerCase().includes(searchText)
                );
            });

            if (filteredStudents.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 4;
                td.className = 'px-4 py-2 text-center text-gray-500';
                td.textContent = 'Tidak ada data siswa.';
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }

            filteredStudents.forEach((student) => {
                const tr = document.createElement('tr');

                const nameTd = document.createElement('td');
                nameTd.className = 'px-4 py-2';
                nameTd.textContent = student.name;
                tr.appendChild(nameTd);

                const nisnTd = document.createElement('td');
                nisnTd.className = 'px-4 py-2';
                nisnTd.textContent = student.nisn;
                tr.appendChild(nisnTd);

                const classTd = document.createElement('td');
                classTd.className = 'px-4 py-2';
                classTd.textContent = student.class;
                tr.appendChild(classTd);

                const actionTd = document.createElement('td');
                actionTd.className = 'px-4 py-2 text-center space-x-2';

                const editBtn = document.createElement('button');
                editBtn.textContent = 'EDIT';
                editBtn.className = 'px-3 py-1 bg-pink-300 text-pink-900 font-semibold rounded hover:bg-pink-400 mb-1 sm:mb-0 sm:mr-1 block sm:inline-block w-full sm:w-auto';
                editBtn.addEventListener('click', () => startEditStudent(student.id));
                actionTd.appendChild(editBtn);

                const detailBtn = document.createElement('button');
                detailBtn.textContent = 'DETAIL';
                detailBtn.className = 'px-3 py-1 bg-blue-300 text-blue-900 font-semibold rounded hover:bg-blue-400 mb-1 sm:mb-0 sm:mr-1 block sm:inline-block w-full sm:w-auto';
                detailBtn.addEventListener('click', () => showStudentDetail(student));
                actionTd.appendChild(detailBtn);

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'HAPUS';
                deleteBtn.className = 'px-3 py-1 bg-pink-300 text-pink-900 font-semibold rounded hover:bg-pink-400 block w-full sm:inline-block sm:w-auto';
                deleteBtn.addEventListener('click', () => deleteStudent(student.id));
                actionTd.appendChild(deleteBtn);

                tr.appendChild(actionTd);

                tbody.appendChild(tr);
            });
        }

        function addStudent(event) {
            event.preventDefault();

            const nameInput = document.getElementById('studentName');
            const classInput = document.getElementById('studentClass');
            const nisnInput = document.getElementById('studentNISN');
            const addressInput = document.getElementById('studentAddress');

            if (
                !nameInput.value.trim() ||
                !classInput.value.trim() ||
                !nisnInput.value.trim() ||
                !addressInput.value.trim()
            ) {
                alert('Semua field harus diisi!');
                return;
            }

            if (editStudentId) {
                // Update existing student
                const studentIndex = students.findIndex(s => s.id === editStudentId);
                if (studentIndex !== -1) {
                    students[studentIndex].name = nameInput.value.trim();
                    students[studentIndex].class = classInput.value.trim();
                    students[studentIndex].nisn = nisnInput.value.trim();
                    students[studentIndex].address = addressInput.value.trim();
                }
                editStudentId = null;
                document.getElementById('submitButton').textContent = 'Tambah';
                document.getElementById('cancelEditButton').classList.add('hidden');
            } else {
                // Add new student
                const newStudent = {
                    id: Date.now(),
                    name: nameInput.value.trim(),
                    class: classInput.value.trim(),
                    nisn: nisnInput.value.trim(),
                    address: addressInput.value.trim()
                };
                students.push(newStudent);
            }

            saveStudents();
            renderStudentList();
            event.target.reset();
        }

        function startEditStudent(id) {
            const student = students.find(s => s.id === id);
            if (!student) return;

            editStudentId = id;
            document.getElementById('studentName').value = student.name;
            document.getElementById('studentClass').value = student.class;
            document.getElementById('studentNISN').value = student.nisn;
            document.getElementById('studentAddress').value = student.address;

            document.getElementById('submitButton').textContent = 'Simpan';
            document.getElementById('cancelEditButton').classList.remove('hidden');
        }

        function cancelEdit() {
            editStudentId = null;
            document.getElementById('studentForm').reset();
            document.getElementById('submitButton').textContent = 'Tambah';
            document.getElementById('cancelEditButton').classList.add('hidden');
        }

        function deleteStudent(id) {
            if (confirm('Apakah Anda yakin ingin menghapus siswa ini?')) {
                students = students.filter(s => s.id !== id);
                saveStudents();
                renderStudentList();
                if (editStudentId === id) {
                    cancelEdit();
                }
            }
        }

        function searchStudents(event) {
            event.preventDefault();
            const filter = document.getElementById('searchInput').value;
            renderStudentList(filter);
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderStudentList();
            document.getElementById('studentForm').addEventListener('submit', addStudent);
            document.getElementById('cancelEditButton').addEventListener('click', cancelEdit);
            document.getElementById('searchForm').addEventListener('submit', searchStudents);
        });

        function showStudentDetail(student) {
            const modal = document.getElementById('studentDetailModal');
            const content = document.getElementById('studentDetailContent');
            content.innerHTML = `
                <p><strong>Nama Lengkap:</strong> ${student.name}</p>
                <p><strong>NISN:</strong> ${student.nisn}</p>
                <p><strong>Kelas:</strong> ${student.class}</p>
                <p><strong>Alamat:</strong> ${student.address}</p>
            `;
            modal.classList.remove('hidden');
        }

        document.getElementById('closeModalBtn').addEventListener('click', () => {
            document.getElementById('studentDetailModal').classList.add('hidden');
        });

        // Close modal when clicking outside the modal content
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('studentDetailModal');
            if (event.target === modal) {
                modal.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
